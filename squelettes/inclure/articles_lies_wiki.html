
[(#REM) Définir le sens du tri]

[(#REM) par défaut type de liaison pour le premier trie]

#SET{trier,type_liaison}

[(#REM) pour le trie par type]
	
#SET{senstri,#ENV{senstri,1}}
	

[(#REM)On fait un tableau des toutes les traductions de l'article de base]

#SET{id_articles,#ARRAY}
<BOUCLE_arts(ARTICLES){id_trad}{id_trad!=0}>1
    #SET{id_articles,#GET{id_articles}|array_merge{#ARRAY{#COMPTEUR_BOUCLE,#ID_ARTICLE}}}
</BOUCLE_arts>
    #SET{id_articles,#GET{id_articles}|array_merge{#ARRAY{#COMPTEUR_BOUCLE,#ID_ARTICLE}}}   
<//B_arts>  


[(#REM) On établit la listes des articles liés aux traductions de l'article de base]

#SET{articles_tous,#ARRAY}	
#SET{date_today,#DATE}		
#SET{types_wiki,#ARRAY}


<BOUCLE_articles_lies(ARTICLES_LIES){id_article IN #GET{id_articles}}{par #GET{trier}}{inverse #GET{senstri}}>
	#SET{articles_tous,#GET{articles_tous}|array_merge{#ARRAY{#COMPTEUR_BOUCLE,#ID_ARTICLE_LIE}}}
</BOUCLE_articles_lies>



[(#REM)Préparation Récuperation des données]

    #SET{rubriques_wiki,(#CONFIG{wiki_cso/rubriques_ressources_wiki}|picker_selected{rubrique})}

    #SET{articles,#GET{articles_tous}}

    #SET{dates,#ARRAY}

[(#REM)On remet le compteur &agrave; 0]
    #SET{articles_tous,#ARRAY}


[(#REM) D&eacute;finir le sens du tri par défaut pour le boucles articles]

[(#REM) par d&eacute;faut]
    #SET{trier,titre}
    #SET{senstri,#ENV{senstri,0}}


<BOUCLE_recherche_trad(ARTICLES){id_rubrique IN #GET{rubriques_wiki}} {id_article IN #GET{articles}} {par #GET{trier}} {inverse #GET{senstri}}>

    #SET{articles_tous,#GET{articles_tous}|array_merge{#ARRAY{#COMPTEUR_BOUCLE,#ID_ARTICLE}}}


		<BOUCLE_trads(ARTICLES){traduction} >
			#SET{articles_tous,#GET{articles_tous}|array_merge{#ARRAY{#COMPTEUR_BOUCLE,#ID_ARTICLE}}}

		</BOUCLE_trads>

</BOUCLE_recherche_trad>


[(#REM) D&eacute;tecter les sens du tri r&eacute;el sens du tri]

    [(#ENV{trier_par}|in_array{#LISTE{lang}}|oui)
    	#SET{senstri,#ENV{senstri,0}}
    ]
    [(#SET{trie_reel,#ENV{trier_par,#GET{trier}}})]
    [(#SET{sens_trie_reel,#ENV{senstrie,#GET{senstri}}})]



[(#ENV{trier_par}|!={lang}|oui)
	#SET{trier,rien}
	]

#SET{compteur,0}
#SET{id_trad,#ARRAY{}}
#SET{trier,#ENV{trier,date}}
[(#ENV{trier}|=={rien}|oui)#SET{trier,' '}]








[(#ENV{affichage}|oui)#SET{affichage,_#ENV{affichage}}]
<B_wiki>
<div class="liste articles wiki"> 
   
    [<p class="pagination">(#PAGINATION)</p>]
    <h2><:contributions:></h2>
    <table class="liste-items">
        <thead>
             <td class="title">
                 [(#ENV{trier_par}|non|ou{#ENV{trier_par}|=={titre}|oui})
                 #SET{senstrititre,1}
                    [(#ENV{senstri}|=={1}|?{#SET{senstrititre,0},#SET{senstrititre,1}})]
                 ]
                  <a class="ajax" href="[(#SELF|parametre_url{trier_par,titre}|parametre_url{senstri,#GET{senstrititre}})]" title="<:title:>"><:title:></a>
                [(#ENV{trier_par}|non|ou{#ENV{trier_par}|=={titre}|oui})
                <div>
                 [(#ENV{senstri}|=={0}|oui|ou{#ENV{trier_par}|non})<img src="[(#CHEMIN{css/img/filter-arrow-down.png})]" alt="down"/>]
                 [(#ENV{senstri}||=={1}|oui)<img src="[(#CHEMIN{css/img/filter-arrow-up.png})]" alt="up"/>]
                 </div>  
                ]
                 </td>
             <td class="note">
              #SET{senstrimoyenne,0}   
              [(#ENV{trier_par}|=={moyenne}|oui)
                    [(#ENV{senstri}|=={1}|?{#SET{senstrimoyenne,0},#SET{senstrimoyenne,1}})]
                 ]
                 <a class="ajax" href="[(#SELF|parametre_url{trier_par,moyenne}|parametre_url{senstri,#GET{senstrimoyenne}})]" title="<:note:>"><:moyenne:></a>
                [(#ENV{trier_par}|=={moyenne}|oui)
                <div>
                  [(#ENV{senstri}|=={0}|oui|ou{#ENV{trier_par}|non})<img src="[(#CHEMIN{css/img/filter-arrow-down.png})]" alt="down"/>]
                  [(#ENV{senstri}||=={1}|oui)<img src="[(#CHEMIN{css/img/filter-arrow-up.png})]" alt="up"/>]
                 </div>  
                ]
                 </td>
             <td class="type_liaison">
              #SET{senstritypeliaison,0}   
              [(#ENV{trier_par}|=={type_liaison}|oui)
                    [(#ENV{senstri}|=={1}|?{#SET{senstritypeliaison,0},#SET{senstritypeliaison,1}})]
                 ]
                 <a class="ajax" href="[(#SELF|parametre_url{trier_par,type_liaison}|parametre_url{senstri,#GET{senstritypeliaison}})]" title="<:type_liaison:>"><:type_liaison:></a>
               [(#ENV{trier_par}|=={type_liaison}|oui)
                <div>
                  [(#ENV{senstri}|=={0}|oui|ou{#ENV{trier_par}|non})<img src="[(#CHEMIN{css/img/filter-arrow-down.png})]" alt="down"/>]
                  [(#ENV{senstri}||=={1}|oui)<img src="[(#CHEMIN{css/img/filter-arrow-up.png})]" alt="up"/>]
                 </div>  
                ]
             </td>
             <td class="language">
              #SET{senstrilang,0}   
              [(#ENV{trier_par}|=={lang}|oui)
                    [(#ENV{senstri}|=={1}|?{#SET{senstrilang,0},#SET{senstrilang,1}})]
                 ]
                <a class="ajax" href="[(#SELF|parametre_url{trier_par,lang}|parametre_url{senstri,#GET{senstrilang}})]" title="<:language:>"><:lang:></a>
                [(#ENV{trier_par}|=={lang}|oui)
                <div>
                  [(#ENV{senstri}|=={0}|oui|ou{#ENV{trier_par}|non})<img src="[(#CHEMIN{css/img/filter-arrow-down.png})]" alt="down"/>]
                  [(#ENV{senstri}||=={1}|oui)<img src="[(#CHEMIN{css/img/filter-arrow-up.png})]" alt="up"/>]
                 </div>  
                ]
            </td>                        
        </thead>
        <tbody>
    <BOUCLE_wiki(ARTICLES){id_rubrique IN #GET{rubriques_wiki}} {id_article IN #GET{articles_tous}}{0,#GET{afficher,10000000}}{pagination 10}>
    [(#SET{id_trad2,#ID_TRAD})]
    #SET{compteur_boucle,#COMPTEUR_BOUCLE}
    #SET{total_boucle,#TOTAL_BOUCLE}    
        <BOUCLE_lang(ARTICLES){id_trad}{id_trad !IN #GET{id_trad}}{si #ENV{wiki_search}|non|ou{#GET{type_liaison}|#GET{trier_par}|=={note}|non}}{id_trad!=0}>
            #SET{compteur,(#GET{compteur}|plus{1})}
            #SET{id_trad,#GET{id_trad}|array_merge{#ARRAY{#COMPTEUR_BOUCLE,#ID_TRAD}}}
            #SET{time_difference,(#GET{date_today}|strtotime|moins{#DATE|strtotime}|div{86400}|round)}
            [(#GET{trier_par}|=={lang}|oui)
                [(#LANG|in_array{#GET{langues}}|non)
                    #SET{#LANG,#ARRAY}
                    ]
                #SET{#LANG,#GET{#LANG}|array_merge{
                            #ARRAY{
                                #COMPTEUR_BOUCLE,#ARRAY{
                                        id_article,#ID_ARTICLE,         
                                        titre,#TITRE,
                                        url_article,#URL_ARTICLE,
                                        time_difference,#GET{time_difference},
                                        id_trad,#ID_TRAD,
                                        id_pays,#PAYS,
                                        lang,#LANG
                                        }}}}    
                #SET{langues,#GET{langues}|array_merge{#ARRAY{#LANG,#LANG}}}
                ]
            [(#GET{trier_par}|=={lang}|non)
                <INCLURE{fond=inclure/articles_wiki_details#GET{affichage},env,id_article,url_article,titre,time_difference=#GET{time_difference},id_trad=#GET{id_trad2},id_pays=#PAYS,compteur_boucle=#GET{compteur_boucle},total_boucle=#GET{total_boucle},date}/>
                ]       
        </BOUCLE_lang>
            <BOUCLE_lang_orig(ARTICLES){id_trad}{id_trad !IN #GET{id_trad}}{origine_traduction}{si #GET{wiki_search}|non|ou{#GET{type_liaison}|oui}|et{#GET{trier_par}|=={note}|non}|et{#GET{lang_sel}|non}}{id_trad!=0}>
                #SET{compteur,(#GET{compteur}|plus{1})}
                #SET{id_trad,#GET{id_trad}|array_merge{#ARRAY{#COMPTEUR_BOUCLE,#ID_TRAD}}}
                #SET{time_difference,(#GET{date_today}|strtotime|moins{#DATE|strtotime}|div{86400}|round)}
                [(#GET{trier_par}|=={lang}|oui)
                    [(#LANG|in_array{#GET{langues}}|non)
                        #SET{#LANG,#ARRAY}
                        ]
                    #SET{#LANG,#GET{#LANG}|array_merge{
                                #ARRAY{
                                    #COMPTEUR_BOUCLE,#ARRAY{
                                            id_article,#ID_ARTICLE,         
                                            titre,#TITRE,
                                            url_article,#URL_ARTICLE,
                                            time_difference,#GET{time_difference},
                                            id_trad,#ID_TRAD,
                                            id_pays,#PAYS,
                                            lang,#GET{lang}
                                            }}}}    
                        #SET{langues,#GET{langues}|array_merge{#ARRAY{#LANG,#LANG}}}
                        ]
                [(#GET{trier_par}|=={lang}|non)
                <INCLURE{fond=inclure/articles_wiki_details#GET{affichage},env,id_article,url_article,titre,time_difference=#GET{time_difference},id_trad=#GET{id_trad2},afficher=#LANG,id_pays=#PAYS,compteur_boucle=#GET{compteur_boucle},total_boucle=#GET{total_boucle},date}/>
                ]
            </BOUCLE_lang_orig>
                <BOUCLE_non_trad(ARTICLES){id_article} {id_trad=0}{si #ENV{trier_par}|=={note}|non}>
                    #SET{compteur,(#GET{compteur}|plus{1})} 
                    #SET{id_trad,#GET{id_trad}|array_merge{#ARRAY{#COMPTEUR_BOUCLE,#ID_TRAD}}}  
                    #SET{time_difference,(#GET{date_today}|strtotime|moins{#DATE|strtotime}|div{86400}|round)}  
                    [(#LANG|=={#ENV{lang}}|?{#SET{lang,''},#SET{lang,#LANG}})]
                    [(#GET{trier_par}|=={lang}|oui)
                        [(#LANG|in_array{#GET{langues}}|non)
                            #SET{#LANG,#ARRAY}
                            ]
                        #SET{#LANG,#GET{#LANG}|array_merge{
                                    #ARRAY{
                                        #COMPTEUR_BOUCLE,#ARRAY{
                                                id_article,#ID_ARTICLE,         
                                                titre,#TITRE,
                                                url_article,#URL_ARTICLE,
                                                time_difference,#GET{time_difference},
                                                id_trad,#ID_TRAD,
                                                id_pays,#PAYS,
                                                lang,#LANG
                                        }}}}    
                                                }}}}    
                            #SET{langues,#GET{langues}|array_merge{#ARRAY{#LANG,#LANG}}}
                        ]
                    [(#GET{trier_par}|=={lang}|non)
                        <INCLURE{fond=inclure/articles_wiki_details#GET{affichage},id_article,url_article,titre,time_difference=#GET{time_difference},env,id_trad=#GET{id_trad2},lang=#GET{lang},id_pays=#PAYS,compteur_boucle=#GET{compteur_boucle},total_boucle=#GET{total_boucle},date}/>
                    ]
                </BOUCLE_non_trad>
                    <BOUCLE_trads_autres_langues(ARTICLES){id_article}{si #GET{trier_par}|=={note}|non|et{#GET{lang_sel}|non}}>
                        #SET{compteur,(#GET{compteur}|plus{1})} 
                        #SET{id_trad,#GET{id_trad}|array_merge{#ARRAY{#COMPTEUR_BOUCLE,#ID_TRAD}}}  
                        #SET{time_difference,(#GET{date_today}|strtotime|moins{#DATE|strtotime}|div{86400}|round)}  
                        [(#LANG|=={#ENV{lang}}|?{#SET{lang,''},#SET{lang,#LANG}})]
                        [(#GET{trier_par}|=={lang}|oui)
                            [(#LANG|in_array{#GET{langues}}|non)
                                #SET{#LANG,#ARRAY}
                                ]
                            #SET{#LANG,#GET{#LANG}|array_merge{
                                        #ARRAY{
                                            #COMPTEUR_BOUCLE,#ARRAY{
                                                    id_article,#ID_ARTICLE,         
                                                    titre,#TITRE,
                                                    url_article,#URL_ARTICLE,
                                                    time_difference,#GET{time_difference},
                                                    id_trad,#ID_TRAD,
                                                    id_pays,#PAYS,
                                                    lang,#GET{lang}
                                                    }}}}    
                                #SET{langues,#GET{langues}|array_merge{#ARRAY{#LANG,#LANG}}}
                            ]
                        [(#GET{trier_par}|=={lang}|non)
                            <INCLURE{fond=inclure/articles_wiki_details#GET{affichage},id_article,url_article,titre,time_difference=#GET{time_difference},env,id_trad=#GET{id_trad2},lang=#GET{lang},id_pays=#PAYS,compteur_boucle=#GET{compteur_boucle},total_boucle=#GET{total_boucle},date}/>
                        ]
                    </BOUCLE_trads_autres_langues>              
                <//B_non_trad>  
                <//B_lang_orig> 
            <//B_lang>  
        <BOUCLE_exception(ARTICLES){id_article} {si #GET{trier_par}|=={note}|oui}>
            #SET{compteur,(#GET{compteur}|plus{1})} 
            #SET{id_trad,#GET{id_trad}|array_merge{#ARRAY{#COMPTEUR_BOUCLE,#ID_TRAD}}}  
            #SET{time_difference,(#GET{date_today}|strtotime|moins{#DATE|strtotime}|div{86400}|round)}  
            [(#LANG|=={#ENV{lang}}|?{#SET{lang,''},#SET{lang,#LANG}})]
            [(#GET{trier_par}|=={lang}|oui)
                [(#LANG|in_array{#GET{langues}}|non)
                    #SET{#LANG,#ARRAY}
                    ]
                #SET{#LANG,#GET{#LANG}|array_merge{
                            #ARRAY{
                                #COMPTEUR_BOUCLE,#ARRAY{
                                        id_article,#ID_ARTICLE,         
                                        titre,#TITRE,
                                        url_article,#URL_ARTICLE,
                                        time_difference,#GET{time_difference},
                                        id_trad,#ID_TRAD,
                                        id_pays,#PAYS,
                                        lang,#GET{lang}
                                        }}}}    
                    #SET{langues,#GET{langues}|array_merge{#ARRAY{#LANG,#LANG}}}
                ]
            [(#GET{trier_par}|=={lang}|non)
                <INCLURE{fond=inclure/articles_wiki_details#GET{affichage},id_article,url_article,titre,time_difference=#GET{time_difference},env,lang=#GET{lang},id_pays=#PAYS,id_trad=#GET{id_trad2},compteur_boucle=#GET{compteur_boucle},total_boucle=#GET{total_boucle},date}/>
                ]
        </BOUCLE_exception>             
                    
    </BOUCLE_wiki>
        #SET{merge_langues,#ARRAY}
        #SET{langues2,#ARRAY}

        <BOUCLE_afficher(POUR){tableau #GET{langues}}{par cle}>
            #SET{merge_langues,#GET{merge_langues}|array_merge{#ARRAY{#CLE,#GET{#VALEUR}}}
        </BOUCLE_afficher>

        <BOUCLE_afficher_i(DATA){source tableau, #GET{langues2}}>
            #SET{merge_langues,#GET{merge_langues}|array_merge{#ARRAY{#CLE,#GET{#VALEUR}}}
        </BOUCLE_afficher_i>
            
            
        <BOUCLE_afficher_liste(DATA){source tableau,#GET{merge_langues}}{par /1}{inverse #ENV{senstri,0}}>
            <BOUCLE_afficher_liste2(DATA){source tableau,#VALEUR}>          <INCLURE{fond=inclure/articles_wiki_details#GET{affichage},id_article=#VALEUR{id_article},url_article=#VALEUR{ur_article},titre=#VALEUR{titre},time_difference=#VALEUR{time_difference},id_trad=#ID_TRAD,env,afficher_lang=#VALEUR{afficher_lang},id_pays=#VALEUR{id_pays},lang_sel=oui,compteur_boucle=#GET{compteur_boucle},total_boucle=#GET{total_boucle},date}/>
            </BOUCLE_afficher_liste2>
            </B_afficher_liste2>        
        </BOUCLE_afficher_liste>
        </tbody>    
    </table>
    [(#GET{compteur}|=={0}|oui)<p class="erreur"><:no_result:></p>]
</div>
</B_wiki>










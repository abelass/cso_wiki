

[(#REM) D&eacute;finir le sens du tri]

[(#REM) par d&eacute;faut]
	#SET{trier,type_liaison}

[(#REM) pour le trie par type]
	
#SET{senstri,#ENV{senstri,1}}
	

[(#REM)On fait un tableau des tous les articles li&eacute;s]

#SET{id_articles,#ARRAY}
<BOUCLE_arts(ARTICLES){id_trad}{id_trad!=0}>
	#SET{id_articles,#GET{id_articles}|array_merge{#ARRAY{#COMPTEUR_BOUCLE,#ID_ARTICLE}}}
</BOUCLE_arts>
	#SET{id_articles,#GET{id_articles}|array_merge{#ARRAY{#COMPTEUR_BOUCLE,#ID_ARTICLE}}}	
<//B_arts>	

#SET{articles_tous,#ARRAY}	
#SET{date_today,#DATE}		
#SET{types_wiki,#ARRAY}
<BOUCLE_types_liaisons(DATA){source tableau, #TYPES_LIAISONS}>
	#SET{types_wiki,#GET{types_wiki}|array_merge{#ARRAY{#CLE,#VALEUR|_T}}}
	<BOUCLE_articles_lies(ARTICLES_LIES){id_article IN #GET{id_articles}}{par #GET{trier}}{inverse #GET{senstri}}{type_liaison=#ENV{type_liaison,#CLE}}>
		#SET{articles_tous,#GET{articles_tous}|array_merge{#ARRAY{#COMPTEUR_BOUCLE,#ID_ARTICLE_LIE}}}
	</BOUCLE_articles_lies>
</BOUCLE_types_liaisons>


[(#REM)Pr&eacute;paration R&eacute;cuperation de donn&eacute;es]

    #SET{rubriques_wiki,(#CONFIG{wiki_cso/rubriques_ressources_wiki}|picker_selected{rubrique})}
    #SET{languages,#ARRAY}
    #SET{articles,#GET{articles_tous}}
    #SET{pays,#ARRAY}
    #SET{dates,#ARRAY}

[(#REM)On remet le compteur &agrave; 0]
    #SET{articles_tous,#ARRAY}


[(#REM) D&eacute;finir le sens du tri]

[(#REM) par d&eacute;faut]
    #SET{trier,date}
    #SET{senstri,#ENV{senstri,1}}
    [(#ENV{trier_par}|in_array{#LISTE{date}}|oui)
    	#SET{trier,#ENV{trier_par}}
    	#SET{senstri,#ENV{senstri,1}}
    ]


<BOUCLE_recherche_trad(ARTICLES){id_rubrique IN #GET{rubriques_wiki}} {id_article IN #GET{articles}} {pays ?=#ENV{pays}}{par #GET{trier}} {inverse #GET{senstri}}>
	[(#ENV{recherche}|non|et{#ENV{trier_par}|=={moyenne}|non}|ou{#ENV{trier_par}|=={lang}|non})
		#SET{articles_tous,#GET{articles_tous}|array_merge{#ARRAY{#COMPTEUR_BOUCLE,#ID_ARTICLE}}}
		]
	<BOUCLE_art(ARTICLES){id_article}>
		<BOUCLE_trads(ARTICLES){traduction}{recherche ?}{date ?>#ENV{periode}} {par #GET{trier}} {inverse #GET{senstri}}>
			[(#ENV{recherche}|oui|ou{#ENV{trier_par}|=={moyenne}|oui}|ou{#ENV{trier_par}|=={lang}|oui})
			#SET{articles_tous,#GET{articles_tous}|array_merge{#ARRAY{#COMPTEUR_BOUCLE,#ID_ARTICLE}}}
			]
			#SET{languages,#GET{languages}|array_merge{#ARRAY{#LANG,#LANG|traduire_nom_langue}}}
			#SET{dates,#GET{dates}|array_merge{#ARRAY{#DATE|affdate{Y-m-d},#DATE|affdate{d-m-Y}}}}
			#SET{pays,#GET{pays}|array_merge{#ARRAY{(#PAYS|name_country),#PAYS}}}	
		</BOUCLE_trads>
	</BOUCLE_art>
</BOUCLE_recherche_trad>


[(#REM) D&eacute;tecter les sens du tri r&eacute;el sens du tri]

    [(#ENV{trier_par}|in_array{#LISTE{lang}}|oui)
    	#SET{senstri,#ENV{senstri,0}}
    ]
    [(#SET{trie_reel,#ENV{trier_par,#GET{trier}}})]
    [(#SET{sens_trie_reel,#ENV{senstrie,#GET{senstri}}})]

<div class="formulaire_spip formulaire_recherche formulaire_recherche_wiki"  id="search">

	<h2 class="titrem"><:info_rechercher_02:></h2>
	<form method="get" action="#SELF#search">
		<input type="hidden" name="wiki_search" value="ok"/>
        <input type="hidden" name="trier_par" value="#ENV{trier_par}"/>
        <input type="hidden" name="senstri" value="#ENV{senstri}"/>             		
	<div>
		<ul>
			[(#SAISIE{input,recherche,label=<:info_rechercher_02:>})]

			
			<li class="display">
				<div class="orderby">
				    <:orderby:> [(#GET{trie_reel}|_T)]
					<span>
					<a class="ajax" href="[(#SELF|parametre_url{trier_par,moyenne})]" title="<:note:>"><:moyenne:></a>
					<a class="ajax" href="[(#SELF|parametre_url{trier_par,date})]" title="<:date:>"><:date:></a>
					<a class="ajax" href="[(#SELF|parametre_url{trier_par,type_liaison})]" title="<:type_liaison:>"><:type_liaison:></a>
					<a class="ajax" href="[(#SELF|parametre_url{trier_par,pays})]" title="<:note:>"><:pays:></a>
					<a class="ajax" href="[(#SELF|parametre_url{trier_par,lang})]" title="<:language:>"><:lang:></a>
					</span>
				</div>
				<div class="sense">
				[(#GET{senstri}|=={0}?{
				<a class="ajax" href="[(#SELF|parametre_url{senstri,1})]" title="<:sense_trie_ascendant:>"><img src="[(#CHEMIN{prive/images/deplierbas.gif})]" alt="down"/> <:sense_trie_ascendant:></a>
				,
				<a class="ajax" href="[(#SELF|parametre_url{senstri,0})]" title="<:sense_trie_descendant:>"><img src="[(#CHEMIN{prive/images/deplierhaut.gif})]" alt="up"/> <:sense_trie_descendant:></a>			
				})]
				</div>
			</li>					
			<li>
				<div class="select"><:advanced_search:></div>
				<ul class="advanced_search">
					[(#SAISIE{selection,pays,label=<:pays:>,option_intro=<:nothing:>,datas=#GET{pays}|array_flip})] 
				
					[(#SAISIE{selection,type_liaison,label=<:type_liaison:>,option_intro=<:nothing:>,datas=#GET{types_wiki}})] 
				
					[(#SAISIE{selection,lang_sel,label=<:language:>,option_intro=<:nothing:>,datas=#GET{languages}})] 
				
					[(#SAISIE{selection,periode,label=<:since:>,option_intro=<:nothing:>,datas=#GET{dates}})] 
				</ul>
			</li>
		</ul>

		<input type="hidden" name="_meta_casier" value="wiki_cso" />
		<p class="boutons"><span class="image_loading">&nbsp;</span><input type="submit" class="submit" value="<:info_rechercher:>" /></p>
	</div>
	</form>
</div>
[(#ENV{pays}|ou{#ENV{type_liaison}}|ou{#ENV{lang_sel}}|ou{#ENV{periode}})
	#SET{recherche_avance,oui}
	]
<script type="text/javascript">
		[(#GET{recherche_avance}|non)
		$('.advanced_search').hide();
		]
		
		$('.select').click(function() {
		  $('.advanced_search').toggle('slow', function() {  
		  });
		});

</script>
#SET{articles,#GET{articles_tous}}
[(#ENV{lang_sel}|oui|ou{#ENV{trier_par}|in_array{#LISTE{pays,note}}|oui})
#SET{articles_tous,#ARRAY}
]


<BOUCLE_filtre_lang(ARTICLES){lang=#ENV{lang_sel}}{id_article IN #GET{articles}} {par date}{inverse #ENV{senstri}}>
	#SET{articles_tous,#GET{articles_tous}|array_merge{#ARRAY{#COMPTEUR_BOUCLE,#ID_ARTICLE}}}
</BOUCLE_filtre_lang>



<BOUCLE_pays(GEO_PAYS) {par multi nom}{si #ENV{trier_par}|=={pays}|oui}{inverse #ENV{senstri}}>
	<BOUCLE_trie_pays(ARTICLES){pays=#ID_PAYS}{id_article IN #GET{articles}}>
		#SET{articles_tous,#GET{articles_tous}|array_merge{#ARRAY{#COMPTEUR_BOUCLE,#ID_ARTICLE}}}
	</BOUCLE_trie_pays>	
</BOUCLE_pays>

[(#ENV{trier_par}|!={lang}|oui)
	#SET{trier,rien}
	]

 <INCLURE{fond=inclure/inc-articles_lies_wiki_liste,rubriques_wiki=#GET{rubriques_wiki},articles_tous=#GET{articles_tous},type_liaison=#GET{types_wiki},trier=#GET{trier},env,afficher=1000000}/>
